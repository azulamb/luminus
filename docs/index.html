<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Luminus</title>
<script src="./luminus.js" data-debug></script>
<style>
slider-input { width: 400px; }
</style>
<script>
( ( element ) =>
{
	customElements.whenDefined( 'lu-world' ).then( () =>
	{
		customElements.define( 'slider-input', element );

		console.log( Luminus );

		const target =
		{
			world: document.getElementById( 'world' ),
		};
		document.querySelectorAll( 'slider-input' ).forEach( ( slider ) =>
		{
			const key = slider.edit;
			if ( !target[ slider.target ] )
			{
				target[ slider.target ] = document.getElementById( slider.target );
			}

			const element = target[ slider.target ];
			slider.value = element[ key ];
			slider.addEventListener( 'change', () =>
			{
				console.log( `${ slider.target }::${ slider.value }` );
				element[ key ] = slider.value;
				target.world.render();
			} );
		} );
	} );
} )(class Slider extends HTMLElement
{
	constructor()
	{
		super();

		const shadow = this.attachShadow( { mode: 'open' } );

		const style = document.createElement( 'style' );
		style.innerHTML =
		[
			':host { display: block; }',
			':host > div { width: 100%; display: grid; grid-template-columns: 20% 70% 10%; }',
			':host > div > input[type="range"] {}',
		].join( '' );

		const name = document.createElement( 'div' );
		name.appendChild( document.createElement( 'slot' ) );

		const onChange = ( e ) =>
		{
			e.stopPropagation();
			this.dispatchEvent( new CustomEvent( 'change' ) );
		};

		this.s = document.createElement( 'input' );
		this.s.type = 'range';
		this.s.step = '0.1';
		this.s.addEventListener( 'change', ( e ) => { this.v.value = this.s.value; onChange( e ); } );

		this.v = document.createElement( 'input' );
		this.v.type = 'number';
		this.v.step = '0.1';
		this.v.addEventListener( 'change', ( e ) => { this.s.value = this.v.value; onChange( e ); } );

		const contents = document.createElement( 'div' );
		contents.appendChild( style );
		contents.appendChild( name );
		contents.appendChild( this.s );
		contents.appendChild( this.v );

		shadow.appendChild( contents );

		this.min = parseInt( this.getAttribute( 'min' ) ) || 0;
		this.max = parseInt( this.getAttribute( 'max' ) ) || 1;
		this.value = this.value;
		this.s.min = this.min;
		this.s.max = this.max;
	}

	get min() { return parseFloat( this.v.min ) || 0; }
	set min( value ) { this.v.min = value + ''; this.setAttribute( 'min', this.v.min ); }

	get max() { return parseFloat( this.v.max ) || 0; }
	set max( value ) { this.v.max = value + ''; this.setAttribute( 'max', this.v.max ); }

	get value() { return parseFloat( this.s.value ); }
	set value( value )
	{
		this.s.value = value;
		this.v.value = value;
	}
	
	get edit() { return this.getAttribute( 'edit' ) || ''; }
	set edit( value ) { this.setAttribute( 'edit', value ); }

	get target() { return this.getAttribute( 'target' ) || ''; }
	set target( value ) { this.setAttribute( 'target', value ); }
} );
</script>
</head>
<body style="display:flex;justify-content:center;flex-direction:column;align-items:center;">
	<lu-world
		id="world"
		width="600" height="400"
		top="20" bottom="-20" left="-30" right="30" near="-10" far="100"
		eyex="10" eyey="10" eyez="10"
		upx="0" upy="1" upz="0"
		centerx="0" centery="0" centerz="0"
		lightx="0.5" lighty="1" lightz="0"
		style="width:600px;height:400px;"
	>
		<lu-axis></lu-axis>
		<lu-vox id="meet" src="./sample.vox" x="-5" y="-8" z="-9"></lu-vox>
		<lu-cube id="cube"></lu-cube>
	</lu-world>
	<slider-input target="world" edit="eyex" min="-10" max="10">Camera-x</slider-input>
	<slider-input target="world" edit="eyey" min="-10" max="10">Camera-y</slider-input>
	<slider-input target="world" edit="eyez" min="-10" max="10">Camera-z</slider-input>
	<slider-input target="world" edit="lightx" min="-1" max="1">Light-x</slider-input>
	<slider-input target="world" edit="lighty" min="-1" max="1">Light-y</slider-input>
	<slider-input target="world" edit="lightz" min="-1" max="1">Light-z</slider-input>
	<slider-input target="cube" edit="x" min="-10" max="10">Cube-x</slider-input>
	<slider-input target="cube" edit="y" min="-10" max="10">Cube-y</slider-input>
	<slider-input target="cube" edit="z" min="-10" max="10">Cube-z</slider-input>
</body>
</html>
